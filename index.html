<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lyrics Sync Tool â€” Start LRC @ 00:00.00</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ Lyrics Sync Tool</h1>
            <p style="opacity:.9">CrÃ©ez des fichiers de paroles synchronisÃ©es facilement â€” PC recommandÃ© pour l'expÃ©rience complÃ¨te.</p>
        </div>
        
        <div class="content">
            <!-- Step 1 -->
            <div class="step" id="step1">
                <h2 style="color:#667eea; margin-bottom:10px">ğŸ“ Informations de la chanson</h2>
                <div class="input-group">
                    <label for="songTitle">Titre de la chanson :</label>
                    <input type="text" id="songTitle" placeholder="Entrez le titre">
                </div>
                <div class="input-group">
                    <label for="artistName">Artiste :</label>
                    <input type="text" id="artistName" placeholder="Entrez l'artiste">
                </div>
            </div>

            <!-- Step 2 - Paroles avec onglets -->
            <div class="step" id="step2">
                <h2 style="color:#667eea; margin-bottom:15px">ğŸ“„ Paroles</h2>
                
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('search')">ğŸ” Rechercher en ligne</button>
                    <button class="tab-btn" onclick="switchTab('paste')">âœï¸ Coller les paroles</button>
                    <button class="tab-btn" onclick="switchTab('upload')">ğŸ“ Uploader fichier</button>
                </div>

                <!-- Tab: Recherche en ligne -->
                <div class="tab-content active" id="tab-search">
                    <div class="info-box info" style="margin-bottom:15px">
                        <strong>ğŸ’¡ Astuce :</strong> Renseignez le titre et l'artiste ci-dessus pour rechercher automatiquement les paroles.
                    </div>
                    <button onclick="searchLyrics()" class="btn-primary">ğŸ” Rechercher les paroles</button>
                    <div id="searchResults" class="search-results" style="display:none"></div>
                </div>

                <!-- Tab: Coller les paroles -->
                <div class="tab-content" id="tab-paste">
                    <div class="info-box info" style="margin-bottom:15px">
                        <strong>ğŸ’¡ Astuce :</strong> Une ligne = une ligne de parole. Appuyez sur EntrÃ©e pour sÃ©parer chaque ligne.
                    </div>
                    <textarea id="lyricsText" placeholder="Collez vos paroles ici...
Chaque ligne doit Ãªtre sÃ©parÃ©e par un retour Ã  la ligne" spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off"></textarea>
                </div>

                <!-- Tab: Upload fichier -->
                <div class="tab-content" id="tab-upload">
                    <div class="info-box info" style="margin-bottom:15px">
                        <strong>ğŸ’¡ Astuce :</strong> SÃ©lectionnez un fichier .txt contenant vos paroles (une ligne par ligne de parole).
                    </div>
                    <div class="file-upload-area">
                        <input type="file" id="lyricsFile" accept=".txt" onchange="loadLyricsFile(event)" style="display:none">
                        <button onclick="$('lyricsFile').click()" class="btn-upload">
                            ğŸ“ Choisir un fichier .txt
                        </button>
                        <div id="lyricsFileInfo" class="file-info"></div>
                    </div>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="step" id="step3">
                <h2 style="color:#667eea; margin-bottom:10px">ğŸ§ Fichier audio / vidÃ©o</h2>
                <div class="info-box warning" style="margin-bottom:15px">
                    <strong>âš ï¸ Limite :</strong> Taille maximale de 80 MB pour garantir un traitement optimal.
                </div>
                <div class="file-upload-zone" onclick="$('audioFile').click()">
                    <input type="file" id="audioFile" accept="audio/*,video/*" onchange="loadAudio(event)" style="display:none">
                    <div class="upload-icon">ğŸ§</div>
                    <div class="upload-text">
                        <strong>Cliquez pour sÃ©lectionner</strong>
                        <span>ou glissez-dÃ©posez votre fichier audio/vidÃ©o</span>
                    </div>
                </div>
                <div id="mainAudioFileInfo" class="file-info-selected"></div>
                <button onclick="startSync()" class="btn-primary" style="margin-top:15px">â–¶ï¸ Commencer la synchronisation</button>
            </div>

            <!-- Sync area -->
            <div class="step sync-area" id="syncArea" style="display:none">
                <h2 style="color:#667eea; margin-bottom:10px">ğŸ¯ Synchronisation en cours</h2>
                <div class="audio-controls">
                    <audio id="audioPlayer" controls></audio>
                    <div class="controls-info">
                        <p><strong>ESPACE</strong> = Pause/Lecture &nbsp;|&nbsp; <strong>ENTRÃ‰E</strong> = Marquer le dÃ©but de la ligne suivante</p>
                        <p>Ligne <span id="currentLineNumber">1</span> / <span id="totalLines">0</span></p>
                    </div>
                </div>
                <div id="status" class="status ready">Appuyez sur ESPACE pour dÃ©marrer la lecture, puis ENTRÃ‰E Ã  chaque changement de ligne</div>
                <div class="lyrics-display" id="lyricsDisplay"></div>
                <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                    <button onclick="resetSync()">ğŸ”„ Recommencer</button>
                    <button onclick="finishSync()">âœ… Terminer</button>
                    <button id="mobileNextBtn" onclick="markNextLineStart()">â¡ï¸ Ligne suivante</button>
                    <div style="font-size:0.9em;color:#555;margin-top:8px;">Remarque : l'utilisation sur ordinateur est plus immersive et simple.</div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="export-section" id="exportSection">
                <h3 style="color:#2e7d32; margin-bottom:15px">ğŸ’¾ Export et Traitement</h3>
                
                <!-- Export basique -->
                <div class="export-group">
                    <h4>ğŸ“„ Fichiers de sous-titres</h4>
                    <div class="button-group">
                        <button onclick="exportLRC()">ğŸ“¥ TÃ©lÃ©charger .LRC</button>
                        <button onclick="exportSRT()">ğŸ“¥ TÃ©lÃ©charger .SRT</button>
                        <button onclick="previewLRC()">ğŸ‘ï¸ AperÃ§u LRC</button>
                        <button onclick="previewSRT()">ğŸ‘ï¸ AperÃ§u SRT</button>
                    </div>
                    <div id="previewArea" class="preview" style="display:none"></div>
                </div>

                <!-- Fusion vidÃ©o + sous-titres -->
                <div class="export-group">
                    <h4>ğŸ¬ Fusionner votre vidÃ©o avec les sous-titres</h4>
                    <div class="info-box warning">
                        <strong>âš ï¸ Important :</strong> Le traitement peut prendre 2 minutes pour un fichier de 20MB. Assurez-vous d'avoir une connexion stable.
                    </div>
                    <div id="videoSourceInfo" class="source-file-info" style="display:none">
                        <div class="source-label">ğŸ“¹ Fichier vidÃ©o source :</div>
                        <div class="source-details" id="videoSourceDetails"></div>
                    </div>
                    <div class="info-box info" style="margin-top:10px" id="noVideoWarning">
                        <strong>â„¹ï¸ Info :</strong> Si votre fichier source est une vidÃ©o, elle sera automatiquement utilisÃ©e. Sinon, vous devrez en sÃ©lectionner une.
                    </div>
                    <div id="videoUploadSection" style="display:none">
                        <div class="file-upload-zone" onclick="$('videoFileForMerge').click()" style="margin-top:12px">
                            <input type="file" id="videoFileForMerge" accept="video/*" onchange="updateVideoFileInfo()" style="display:none">
                            <div class="upload-icon">ğŸ¬</div>
                            <div class="upload-text">
                                <strong>Cliquez pour sÃ©lectionner une vidÃ©o</strong>
                                <span>Taille maximale : 80 MB</span>
                            </div>
                        </div>
                        <div class="file-info-selected" id="videoFileInfo"></div>
                    </div>
                    <button onclick="mergeVideoWithSubtitles()" class="btn-primary" style="margin-top:10px">
                        ğŸ¬ Fusionner vidÃ©o + sous-titres
                    </button>
                </div>

                <!-- CrÃ©er vidÃ©o avec paroles -->
                <div class="export-group">
                    <h4>ğŸ¨ CrÃ©er une vidÃ©o avec paroles animÃ©es</h4>
                    <div class="info-box info">
                        <strong>â„¹ï¸ Info :</strong> CrÃ©ez une vidÃ©o pour YouTube/rÃ©seaux sociaux avec votre audio + image de fond + paroles synchronisÃ©es.
                    </div>
                    <div id="audioSourceInfo" class="source-file-info" style="display:none">
                        <div class="source-label">ğŸµ Fichier audio source :</div>
                        <div class="source-details" id="audioSourceDetails"></div>
                        <button onclick="changeAudioSource()" class="btn-change">ğŸ”„ Changer l'audio</button>
                    </div>
                    <div id="audioUploadSection" style="display:none">
                        <div class="file-upload-zone" onclick="$('audioFileForVideo').click()" style="margin-top:12px">
                            <input type="file" id="audioFileForVideo" accept="audio/*" onchange="updateAudioFileInfo()" style="display:none">
                            <div class="upload-icon">ğŸµ</div>
                            <div class="upload-text">
                                <strong>Cliquez pour sÃ©lectionner un audio</strong>
                                <span>Taille maximale : 80 MB</span>
                            </div>
                        </div>
                        <div class="file-info-selected" id="audioFileInfo"></div>
                    </div>
                    <div class="file-upload-zone" onclick="$('backgroundImage').click()" style="margin-top:12px">
                        <input type="file" id="backgroundImage" accept="image/*" onchange="previewBackground(event)" style="display:none">
                        <div class="upload-icon">ğŸ–¼ï¸</div>
                        <div class="upload-text">
                            <strong>Cliquez pour sÃ©lectionner une image de fond</strong>
                            <span>RecommandÃ© : 1920x1080 â€¢ Format : JPG, PNG</span>
                        </div>
                    </div>
                    <div id="bgPreview" class="bg-preview"></div>
                    <button onclick="createLyricsVideo()" class="btn-primary">
                        ğŸ¨ CrÃ©er vidÃ©o avec paroles
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de progression -->
    <div id="progressModal" class="modal" style="display:none">
        <div class="modal-content progress-modal">
            <div class="modal-header">
                <h3 id="progressTitle">â³ Traitement en cours...</h3>
            </div>
            <div class="modal-body">
                <div class="progress-info">
                    <div id="progressMessage" class="progress-message">Envoi du fichier au serveur...</div>
                    <div class="progress-bar-container">
                        <div id="progressBar" class="progress-bar">
                            <span id="progressBarText"></span>
                        </div>
                    </div>
                    <div class="progress-stats">
                        <span id="progressPercent">0%</span>
                        <span id="progressTime"></span>
                    </div>
                </div>
                <div class="spinner"></div>
                <div class="info-box warning" style="margin-top:20px">
                    <strong>âš ï¸ Ne fermez pas cette page</strong> pendant le traitement. Cela peut prendre plusieurs minutes selon la taille de votre fichier.
                </div>
                <div class="progress-details" id="progressDetails"></div>
            </div>
        </div>
    </div>

    <!-- Modal de rÃ©sultat -->
    <div id="resultModal" class="modal" style="display:none">
        <div class="modal-content result-modal">
            <div class="modal-header">
                <h3 id="resultTitle"></h3>
            </div>
            <div class="modal-body">
                <div id="resultMessage"></div>
                <div id="resultPreview" class="result-preview"></div>
                <div class="modal-buttons">
                    <button onclick="closeResultModal()" class="btn-secondary">Fermer</button>
                    <button id="downloadResultBtn" style="display:none" class="btn-primary">ğŸ“¥ TÃ©lÃ©charger</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./script.js"></script>
</body>
</html>